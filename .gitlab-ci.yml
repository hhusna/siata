stages:
  - deploy # Pastikan kamu punya stage deploy atau ganti sesuai kebutuhan

# -----------------------------------------------------------
# JOB: Deploy Dokumentasi ke GitHub Pages
# -----------------------------------------------------------
deploy_to_github:
  stage: deploy
  image: alpine/git:latest # Menggunakan image ringan yang sudah ada Git
  variables:
    # Ganti dengan username GitHub kamu
    GITHUB_USER: "azelvon" 
    # Ganti dengan nama repositori GitHub tujuan (misalnya "nama_github_kamu.github.io")
    GITHUB_REPO: "SIATA_Documentation" 
    # Branch yang dipakai GitHub Pages untuk publikasi (biasanya main atau gh-pages)
    GITHUB_PAGES_BRANCH: "main" 
    # Folder lokal yang berisi file dokumentasi kamu (tempat index.html berada)
    DOCS_DIR: "dokumentasi" 

  before_script:
    # Mengatur kredensial Git agar bisa otentikasi menggunakan token
    - git config user.name "GitLab CI Runner"
    - git config user.email "ci-runner@gitlab.com"
    # URL lengkap repositori GitHub yang menggunakan token sebagai password
    - export REMOTE_URL="https://${GITHUB_USER}:${GITHUB_TOKEN}@github.com/${GITHUB_USER}/${GITHUB_REPO}.git"

  script:
    - echo "--- Mulai Deployment Dokumentasi ke GitHub ---"
    
    # 1. Clone repositori tujuan GitHub
    - git clone --branch ${GITHUB_PAGES_BRANCH} $REMOTE_URL temp_repo
    
    # 2. Kosongkan folder dokumentasi lama di repo tujuan
    - cd temp_repo
    - git rm -rf .
    
    # 3. Salin file baru dari folder lokal ke folder clone
    - cp -r ../${DOCS_DIR}/. .
    
    # 4. Tambahkan, commit, dan push perubahan
    - git add .
    - git commit -m "CI: Update documentation from GitLab CI" || echo "Tidak ada perubahan untuk di commit"
    - git push $REMOTE_URL ${GITHUB_PAGES_BRANCH} --force # --force digunakan untuk menimpa history jika perlu
    
    - echo "--- Deployment Selesai. Cek GitHub Pages kamu ---"
  
  # Hanya jalankan job ini jika ada perubahan di branch utama dan folder dokumentasi
  only:
    - main 
  # Hanya jalankan jika job sebelumnya berhasil
  dependencies: []